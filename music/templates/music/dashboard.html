{% extends 'music/base.html' %}
{% load static %}

{% block content %}
{% debug %}
{{ stats|pprint }}
<div class="container-fluid">
    <h2 class="mb-4"><i class="fas fa-tachometer-alt me-2"></i>系统仪表盘</h2>
    
    <!-- 核心指标 -->
    <div class="row g-4 mb-4">
        {% for key, value in stats.system_stats.items %}
        <div class="col-6 col-md-3">
            <div class="card shadow-sm border-start-{% cycle 'primary' 'success' 'info' 'warning' %} border-4">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="flex-grow-1">
                            <div class="h5 mb-0">{{ value|filesizeformat|default:value }}</div>
                            <small class="text-muted text-uppercase">
                                {% if key == 'storage_usage' %}存储用量
                                {% else %}{{ key|title }}{% endif %}
                            </small>
                        </div>
                        <div class="ms-3">
                            <i class="fas 
                                {% if key == 'total_users' %}fa-users 
                                {% elif key == 'active_users' %}fa-user-check
                                {% elif key == 'total_music' %}fa-music
                                {% else %}fa-database{% endif %} 
                                fa-2x text-muted"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- 近期活动 -->
    <div class="row g-4">
        <div class="col-lg-6">
            <div class="card shadow-sm">
                <div class="card-header bg-warning text-white">
                    <h5 class="mb-0"><i class="fas fa-bell me-2"></i>实时动态</h5>
                </div>
                <div class="card-body">
                    <div class="list-group">
                        <div class="list-group-item d-flex justify-content-between">
                            <span>今日新增用户</span>
                            <strong>{{ stats.recent_activity.new_users }}</strong>
                        </div>
                        <div class="list-group-item d-flex justify-content-between">
                            <span>今日新增歌曲</span>
                            <strong>{{ stats.recent_activity.new_music }}</strong>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 热门内容 -->
        <div class="col-lg-6">
            <div class="card shadow-sm">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0"><i class="fas fa-fire me-2"></i>热门内容</h5>
                </div>
                <div class="card-body">
                    <h6><i class="fas fa-play-circle me-2"></i>最多播放</h6>
                    {% for music in stats.popular_content.most_played %}
                    <div class="d-flex justify-content-between mb-2">
                        <a href="{% url 'music_detail' music.id %}" class="text-decoration-none">
                            {{ music.title|truncatechars:20 }}
                        </a>
                        <span class="text-muted">{{ music.play_count }} 次</span>
                    </div>
                    {% endfor %}
                    
                    <hr>
                    
                    <h6><i class="fas fa-download me-2"></i>最多下载</h6>
                    {% for music in stats.popular_content.most_downloaded %}
                    <div class="d-flex justify-content-between mb-2">
                        <a href="{% url 'music_detail' music.id %}" class="text-decoration-none">
                            {{ music.title|truncatechars:20 }}
                        </a>
                        <span class="text-muted">{{ music.download_count }} 次</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %} 